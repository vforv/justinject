"use strict";var cov_15xygthlya=function(){var path="/home/vladimir/Documents/ts-di/src/Container.ts",hash="f4bc4f3eeb0e8b5b7d1b35161569dbfcf34e57ab",Function=function(){}.constructor,global=new Function('return this')(),gcv="__coverage__",coverageData={path:"/home/vladimir/Documents/ts-di/src/Container.ts",statementMap:{"0":{start:{line:2,column:0},end:{line:2,column:62}},"1":{start:{line:3,column:0},end:{line:3,column:28}},"2":{start:{line:5,column:0},end:{line:141,column:4}},"3":{start:{line:7,column:8},end:{line:7,column:33}},"4":{start:{line:8,column:8},end:{line:8,column:37}},"5":{start:{line:9,column:8},end:{line:9,column:31}},"6":{start:{line:10,column:8},end:{line:10,column:30}},"7":{start:{line:13,column:8},end:{line:13,column:42}},"8":{start:{line:22,column:23},end:{line:22,column:77}},"9":{start:{line:23,column:27},end:{line:23,column:82}},"10":{start:{line:23,column:49},end:{line:23,column:81}},"11":{start:{line:24,column:8},end:{line:27,column:9}},"12":{start:{line:25,column:30},end:{line:25,column:50}},"13":{start:{line:26,column:12},end:{line:26,column:68}},"14":{start:{line:28,column:8},end:{line:28,column:61}},"15":{start:{line:36,column:8},end:{line:36,column:29}},"16":{start:{line:37,column:8},end:{line:50,column:11}},"17":{start:{line:38,column:38},end:{line:38,column:66}},"18":{start:{line:39,column:38},end:{line:39,column:77}},"19":{start:{line:40,column:12},end:{line:42,column:13}},"20":{start:{line:41,column:16},end:{line:41,column:63}},"21":{start:{line:43,column:12},end:{line:47,column:13}},"22":{start:{line:44,column:16},end:{line:46,column:17}},"23":{start:{line:45,column:20},end:{line:45,column:96}},"24":{start:{line:48,column:12},end:{line:48,column:51}},"25":{start:{line:49,column:12},end:{line:49,column:53}},"26":{start:{line:58,column:8},end:{line:58,column:52}},"27":{start:{line:66,column:8},end:{line:66,column:52}},"28":{start:{line:76,column:8},end:{line:93,column:9}},"29":{start:{line:78,column:16},end:{line:84,column:17}},"30":{start:{line:80,column:20},end:{line:80,column:44}},"31":{start:{line:81,column:32},end:{line:81,column:57}},"32":{start:{line:82,column:20},end:{line:82,column:55}},"33":{start:{line:83,column:20},end:{line:83,column:31}},"34":{start:{line:85,column:16},end:{line:85,column:53}},"35":{start:{line:88,column:16},end:{line:88,column:49}},"36":{start:{line:91,column:16},end:{line:91,column:49}},"37":{start:{line:102,column:8},end:{line:102,column:73}},"38":{start:{line:103,column:8},end:{line:103,column:68}},"39":{start:{line:104,column:8},end:{line:114,column:9}},"40":{start:{line:106,column:16},end:{line:106,column:64}},"41":{start:{line:109,column:16},end:{line:109,column:78}},"42":{start:{line:112,column:16},end:{line:112,column:78}},"43":{start:{line:123,column:8},end:{line:123,column:46}},"44":{start:{line:124,column:8},end:{line:139,column:9}},"45":{start:{line:126,column:16},end:{line:126,column:63}},"46":{start:{line:127,column:16},end:{line:127,column:52}},"47":{start:{line:128,column:16},end:{line:128,column:30}},"48":{start:{line:131,column:16},end:{line:133,column:17}},"49":{start:{line:132,column:20},end:{line:132,column:65}},"50":{start:{line:134,column:16},end:{line:134,column:30}},"51":{start:{line:137,column:16},end:{line:137,column:104}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:6,column:4},end:{line:6,column:5}},loc:{start:{line:6,column:18},end:{line:11,column:5}},line:6},"1":{name:"(anonymous_1)",decl:{start:{line:12,column:4},end:{line:12,column:5}},loc:{start:{line:12,column:22},end:{line:14,column:5}},line:12},"2":{name:"(anonymous_2)",decl:{start:{line:20,column:4},end:{line:20,column:5}},loc:{start:{line:20,column:20},end:{line:29,column:5}},line:20},"3":{name:"(anonymous_3)",decl:{start:{line:23,column:38},end:{line:23,column:39}},loc:{start:{line:23,column:49},end:{line:23,column:81}},line:23},"4":{name:"(anonymous_4)",decl:{start:{line:35,column:4},end:{line:35,column:5}},loc:{start:{line:35,column:16},end:{line:51,column:5}},line:35},"5":{name:"(anonymous_5)",decl:{start:{line:37,column:18},end:{line:37,column:19}},loc:{start:{line:37,column:30},end:{line:50,column:9}},line:37},"6":{name:"(anonymous_6)",decl:{start:{line:57,column:4},end:{line:57,column:5}},loc:{start:{line:57,column:20},end:{line:59,column:5}},line:57},"7":{name:"(anonymous_7)",decl:{start:{line:65,column:4},end:{line:65,column:5}},loc:{start:{line:65,column:26},end:{line:67,column:5}},line:65},"8":{name:"(anonymous_8)",decl:{start:{line:75,column:4},end:{line:75,column:5}},loc:{start:{line:75,column:45},end:{line:94,column:5}},line:75},"9":{name:"(anonymous_9)",decl:{start:{line:101,column:4},end:{line:101,column:5}},loc:{start:{line:101,column:48},end:{line:115,column:5}},line:101},"10":{name:"(anonymous_10)",decl:{start:{line:122,column:4},end:{line:122,column:5}},loc:{start:{line:122,column:33},end:{line:140,column:5}},line:122}},branchMap:{"0":{loc:{start:{line:22,column:23},end:{line:22,column:77}},type:"binary-expr",locations:[{start:{line:22,column:23},end:{line:22,column:71}},{start:{line:22,column:75},end:{line:22,column:77}}],line:22},"1":{loc:{start:{line:24,column:8},end:{line:27,column:9}},type:"if",locations:[{start:{line:24,column:8},end:{line:27,column:9}},{start:{line:24,column:8},end:{line:27,column:9}}],line:24},"2":{loc:{start:{line:24,column:12},end:{line:24,column:55}},type:"binary-expr",locations:[{start:{line:24,column:12},end:{line:24,column:25}},{start:{line:24,column:29},end:{line:24,column:55}}],line:24},"3":{loc:{start:{line:40,column:12},end:{line:42,column:13}},type:"if",locations:[{start:{line:40,column:12},end:{line:42,column:13}},{start:{line:40,column:12},end:{line:42,column:13}}],line:40},"4":{loc:{start:{line:43,column:12},end:{line:47,column:13}},type:"if",locations:[{start:{line:43,column:12},end:{line:47,column:13}},{start:{line:43,column:12},end:{line:47,column:13}}],line:43},"5":{loc:{start:{line:43,column:16},end:{line:43,column:67}},type:"binary-expr",locations:[{start:{line:43,column:16},end:{line:43,column:32}},{start:{line:43,column:36},end:{line:43,column:67}}],line:43},"6":{loc:{start:{line:44,column:16},end:{line:46,column:17}},type:"if",locations:[{start:{line:44,column:16},end:{line:46,column:17}},{start:{line:44,column:16},end:{line:46,column:17}}],line:44},"7":{loc:{start:{line:76,column:8},end:{line:93,column:9}},type:"switch",locations:[{start:{line:77,column:12},end:{line:86,column:13}},{start:{line:87,column:12},end:{line:89,column:13}},{start:{line:90,column:12},end:{line:92,column:13}}],line:76},"8":{loc:{start:{line:78,column:16},end:{line:84,column:17}},type:"if",locations:[{start:{line:78,column:16},end:{line:84,column:17}},{start:{line:78,column:16},end:{line:84,column:17}}],line:78},"9":{loc:{start:{line:104,column:8},end:{line:114,column:9}},type:"switch",locations:[{start:{line:105,column:12},end:{line:107,column:13}},{start:{line:108,column:12},end:{line:110,column:13}},{start:{line:111,column:12},end:{line:113,column:13}}],line:104},"10":{loc:{start:{line:124,column:8},end:{line:139,column:9}},type:"switch",locations:[{start:{line:125,column:12},end:{line:129,column:13}},{start:{line:130,column:12},end:{line:135,column:13}},{start:{line:136,column:12},end:{line:138,column:13}}],line:124},"11":{loc:{start:{line:131,column:16},end:{line:133,column:17}},type:"if",locations:[{start:{line:131,column:16},end:{line:133,column:17}},{start:{line:131,column:16},end:{line:133,column:17}}],line:131}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0,0],"8":[0,0],"9":[0,0,0],"10":[0,0,0],"11":[0,0]},_coverageSchema:"332fd63041d2c1bcb487cc26dd0d5f7d97098a6c"},coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}coverageData.hash=hash;return coverage[path]=coverageData;}();cov_15xygthlya.s[0]++;Object.defineProperty(exports,"__esModule",{value:true});cov_15xygthlya.s[1]++;require("reflect-metadata");/*eslint new-parens: "error"*/cov_15xygthlya.s[2]++;exports.Container=new class{constructor(){cov_15xygthlya.f[0]++;cov_15xygthlya.s[3]++;this.service=new Map();cov_15xygthlya.s[4]++;this.serviceType=new Map();cov_15xygthlya.s[5]++;this.mocks=new Map();cov_15xygthlya.s[6]++;this.hasMocks=false;}set(target,type){cov_15xygthlya.f[1]++;cov_15xygthlya.s[7]++;this.setserviceType(target,type);}/**
     * Resolove service with all deps
     *
     * @param target service to resolve
     */resolve(target){cov_15xygthlya.f[2]++;// tokens are required dependencies, while injections are resolved tokens from the Container
const tokens=(cov_15xygthlya.s[8]++,(cov_15xygthlya.b[0][0]++,Reflect.getMetadata('design:paramtypes',target))||(cov_15xygthlya.b[0][1]++,[]));const injections=(cov_15xygthlya.s[9]++,tokens.map(token=>{cov_15xygthlya.f[3]++;cov_15xygthlya.s[10]++;return exports.Container.resolve(token);}));cov_15xygthlya.s[11]++;if((cov_15xygthlya.b[2][0]++,this.hasMocks)&&(cov_15xygthlya.b[2][1]++,this.isMockedClass(target))){cov_15xygthlya.b[1][0]++;const MockClass=(cov_15xygthlya.s[12]++,this.getMock(target));cov_15xygthlya.s[13]++;return this.resolveByserviceType(MockClass,injections);}else{cov_15xygthlya.b[1][1]++;}cov_15xygthlya.s[14]++;return this.resolveByserviceType(target,injections);}/**
     * Mock or replace service
     *
     * @param mocks all mocking services
     */mock(mocks){cov_15xygthlya.f[4]++;cov_15xygthlya.s[15]++;this.hasMocks=true;cov_15xygthlya.s[16]++;mocks.map(target=>{cov_15xygthlya.f[5]++;const serviceToMockName=(cov_15xygthlya.s[17]++,target.dep.name.slice(0,-4));const serviceToMockType=(cov_15xygthlya.s[18]++,this.serviceType.get(serviceToMockName));cov_15xygthlya.s[19]++;if(target.dep.name.slice(-4)!=='Mock'){cov_15xygthlya.b[3][0]++;cov_15xygthlya.s[20]++;throw Error('Class name must end with "Mock"');}else{cov_15xygthlya.b[3][1]++;}cov_15xygthlya.s[21]++;if((cov_15xygthlya.b[5][0]++,!target.override)&&(cov_15xygthlya.b[5][1]++,serviceToMockType==='default')){cov_15xygthlya.b[4][0]++;cov_15xygthlya.s[22]++;if(!(target.dep.prototype instanceof this.service.get(serviceToMockName))){cov_15xygthlya.b[6][0]++;cov_15xygthlya.s[23]++;throw Error('"Mock" class must extends main instance, or use override tag');}else{cov_15xygthlya.b[6][1]++;}}else{cov_15xygthlya.b[4][1]++;}cov_15xygthlya.s[24]++;this.service.delete(serviceToMockName);cov_15xygthlya.s[25]++;this.setMocks(target,serviceToMockType);});}/**
     * Get mocking service
     *
     * @param target service which we want to mock
     */getMock(target){cov_15xygthlya.f[6]++;cov_15xygthlya.s[26]++;return this.mocks.get(`${target.name}Mock`);}/**
     * Check if target service, the service we want to mock
     *
     * @param target service which we want to mock
     */isMockedClass(target){cov_15xygthlya.f[7]++;cov_15xygthlya.s[27]++;return this.mocks.has(`${target.name}Mock`);}/**
     * This will reslove service, if service is sinleton
     * we need just to return instance
     *
     * @param target service
     * @param injections dependencies
     */resolveByserviceType(target,injections){cov_15xygthlya.f[8]++;cov_15xygthlya.s[28]++;switch(this.serviceType.get(target.name)){case'singleton':cov_15xygthlya.b[7][0]++;{cov_15xygthlya.s[29]++;if(this.service.get(target.name)===null){cov_15xygthlya.b[8][0]++;cov_15xygthlya.s[30]++;// resolve each mocked service here
console.log(injections);const inj=(cov_15xygthlya.s[31]++,new target(...injections));cov_15xygthlya.s[32]++;this.service.set(target.name,inj);cov_15xygthlya.s[33]++;return inj;}else{cov_15xygthlya.b[8][1]++;}cov_15xygthlya.s[34]++;return this.service.get(target.name);}case'default':cov_15xygthlya.b[7][1]++;{cov_15xygthlya.s[35]++;return new target(...injections);}default:cov_15xygthlya.b[7][2]++;{cov_15xygthlya.s[36]++;return new target(...injections);}}}/**
     * This will add mocking services to service property
     *
     * @param mockingService
     * @param serviceToMockType
     */setMocks(mockingService,serviceToMockType){cov_15xygthlya.f[9]++;cov_15xygthlya.s[37]++;this.serviceType.set(mockingService.dep.name,serviceToMockType);cov_15xygthlya.s[38]++;this.mocks.set(mockingService.dep.name,mockingService.dep);cov_15xygthlya.s[39]++;switch(serviceToMockType){case'singleton':cov_15xygthlya.b[9][0]++;{cov_15xygthlya.s[40]++;this.service.set(mockingService.dep.name,null);}case'default':cov_15xygthlya.b[9][1]++;{cov_15xygthlya.s[41]++;this.service.set(mockingService.dep.name,mockingService.dep);}default:cov_15xygthlya.b[9][2]++;{cov_15xygthlya.s[42]++;this.service.set(mockingService.dep.name,mockingService.dep);}}}/**
     * Add new service
     *
     * @param target new service to add
     * @param type Type of service
     */setserviceType(target,type){cov_15xygthlya.f[10]++;cov_15xygthlya.s[43]++;this.service.set(target.name,target);cov_15xygthlya.s[44]++;switch(type){case'singleton':cov_15xygthlya.b[10][0]++;{cov_15xygthlya.s[45]++;this.serviceType.set(target.name,'singleton');cov_15xygthlya.s[46]++;this.service.set(target.name,null);cov_15xygthlya.s[47]++;return target;}case undefined:cov_15xygthlya.b[10][1]++;{cov_15xygthlya.s[48]++;if(!this.serviceType.has(target.name)){cov_15xygthlya.b[11][0]++;cov_15xygthlya.s[49]++;this.serviceType.set(target.name,'default');}else{cov_15xygthlya.b[11][1]++;}cov_15xygthlya.s[50]++;return target;}default:cov_15xygthlya.b[10][2]++;{cov_15xygthlya.s[51]++;throw Error(`Please check ${target.name} service. Service type ${type} doesn't exists`);}}}}();//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiL2hvbWUvdmxhZGltaXIvRG9jdW1lbnRzL3RzLWRpL3NyYy9Db250YWluZXIudHMiLCJzb3VyY2VzIjpbIi9ob21lL3ZsYWRpbWlyL0RvY3VtZW50cy90cy1kaS9zcmMvQ29udGFpbmVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsNEJBQTBCO0FBRzFCLDhCQUE4QjtBQUNqQixRQUFBLFNBQVMsR0FBRyxJQUFJO0lBTXpCO1FBTFEsWUFBTyxHQUFrQixJQUFJLEdBQUcsRUFBbUIsQ0FBQztRQUNwRCxnQkFBVyxHQUFrQixJQUFJLEdBQUcsRUFBbUIsQ0FBQztRQUN4RCxVQUFLLEdBQWtCLElBQUksR0FBRyxFQUFtQixDQUFDO1FBSXRELElBQUksQ0FBQyxRQUFRLEdBQUcsS0FBSyxDQUFDO0lBQzFCLENBQUM7SUFFTSxHQUFHLENBQUMsTUFBa0IsRUFBRSxJQUFhO1FBQ3hDLElBQUksQ0FBQyxjQUFjLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxDQUFDO0lBQ3RDLENBQUM7SUFFRDs7OztPQUlHO0lBQ0ksT0FBTyxDQUFJLE1BQVc7UUFFekIsNEZBQTRGO1FBQzVGLE1BQU0sTUFBTSxHQUFRLE9BQU8sQ0FBQyxXQUFXLENBQUMsbUJBQW1CLEVBQUUsTUFBTSxDQUFDLElBQUksRUFBRSxDQUFDO1FBQzNFLE1BQU0sVUFBVSxHQUFHLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxLQUFVLEVBQUUsRUFBRSxDQUFDLGlCQUFTLENBQUMsT0FBTyxDQUFNLEtBQUssQ0FBQyxDQUFDLENBQUM7UUFFN0UsSUFBSSxJQUFJLENBQUMsUUFBUSxJQUFJLElBQUksQ0FBQyxhQUFhLENBQUMsTUFBTSxDQUFDLEVBQUU7WUFDN0MsTUFBTSxTQUFTLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUN2QyxPQUFPLElBQUksQ0FBQyxvQkFBb0IsQ0FBSSxTQUFTLEVBQUUsVUFBVSxDQUFDLENBQUM7U0FDOUQ7UUFFRCxPQUFPLElBQUks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LENBQUMsV0FBVyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEVBQUU7b0JBQ3BDLElBQUksQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUUsU0FBUyxDQUFDLENBQUM7aUJBQ2hEO2dCQUVELE9BQU8sTUFBTSxDQUFDO2FBQ2pCO1lBQ0QsT0FBTyxDQUFDLENBQUM7Z0JBQ0wsTUFBTSxLQUFLLENBQUMsZ0JBQWdCLE1BQU0sQ0FBQyxJQUFJLDBCQUEwQixJQUFJLGlCQUFpQixDQUFDLENBQUM7YUFDM0Y7U0FDSjtJQUVMLENBQUM7Q0FDSixFQUFFLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgJ3JlZmxlY3QtbWV0YWRhdGEnO1xuaW1wb3J0IHsgIElUeXBlLCBNb2NraW5nVHlwZSB9IGZyb20gJy4vTW9kZWwnO1xuXG4vKmVzbGludCBuZXctcGFyZW5zOiBcImVycm9yXCIqL1xuZXhwb3J0IGNvbnN0IENvbnRhaW5lciA9IG5ldyBjbGFzcyB7XG4gICAgcHJpdmF0ZSBzZXJ2aWNlOiBNYXA8YW55LCBhbnk+ID0gbmV3IE1hcDxhbnksIElUeXBlPGFueT4+KCk7XG4gICAgcHJpdmF0ZSBzZXJ2aWNlVHlwZTogTWFwPGFueSwgYW55PiA9IG5ldyBNYXA8YW55LCBJVHlwZTxhbnk+PigpO1xuICAgIHByaXZhdGUgbW9ja3M6IE1hcDxhbnksIGFueT4gPSBuZXcgTWFwPGFueSwgSVR5cGU8YW55Pj4oKTtcbiAgICBwcml2YXRlIGhhc01vY2tzOiBib29sZWFuO1xuXG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMuaGFzTW9ja3MgPSBmYWxzZTtcbiAgICB9XG5cbiAgICBwdWJsaWMgc2V0KHRhcmdldDogSVR5cGU8YW55PiwgdHlwZT86IHN0cmluZykge1xuICAgICAgICB0aGlzLnNldHNlcnZpY2VUeXBlKHRhcmdldCwgdHlwZSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVzb2xvdmUgc2VydmljZSB3aXRoIGFsbCBkZXBzXG4gICAgICpcbiAgICAgKiBAcGFyYW0gdGFyZ2V0IHNlcnZpY2UgdG8gcmVzb2x2ZVxuICAgICAqL1xuICAgIHB1YmxpYyByZXNvbHZlPFQ+KHRhcmdldDogYW55KTogVCB7XG5cbiAgICAgICAgLy8gdG9rZW5zIGFyZSByZXF1aXJlZCBkZXBlbmRlbmNpZXMsIHdoaWxlIGluamVjdGlvbnMgYXJlIHJlc29sdmVkIHRva2VucyBmcm9tIHRoZSBDb250YWluZXJcbiAgICAgICAgY29uc3QgdG9rZW5zOiBhbnkgPSBSZWZsZWN0LmdldE1ldGFkYXRhKCdkZXNpZ246cGFyYW10eXBlcycsIHRhcmdldCkgfHwgW107XG4gICAgICAgIGNvbnN0IGluamVjdGlvbnMgPSB0b2tlbnMubWFwKCh0b2tlbjogYW55KSA9PiBDb250YWluZXIucmVzb2x2ZTxhbnk+KHRva2VuKSk7XG5cbiAgICAgICAgaWYgKHRoaXMuaGFzTW9ja3MgJiYgdGhpcy5pc01vY2tlZENsYXNzKHRhcmdldCkpIHtcbiAgICAgICAgICAgIGNvbnN0IE1vY2tDbGFzcyA9IHRoaXMuZ2V0TW9jayh0YXJnZXQpO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMucmVzb2x2ZUJ5c2VydmljZVR5cGU8VD4oTW9ja0NsYXNzLCBpbmplY3Rpb25zKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzLnJlc29sdmVCeXNlcnZpY2VUeXBlPFQ+KHRhcmdldCwgaW5qZWN0aW9ucyk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogTW9jayBvciByZXBsYWNlIHNlcnZpY2VcbiAgICAgKlxuICAgICAqIEBwYXJhbSBtb2NrcyBhbGwgbW9ja2luZyBzZXJ2aWNlc1xuICAgICAqL1xuICAgIHB1YmxpYyBtb2NrKG1vY2tzOiBNb2NraW5nVHlwZSkge1xuICAgICAgICB0aGlzLmhhc01vY2tzID0gdHJ1ZTtcblxuICAgICAgICBtb2Nrcy5tYXAoKHRhcmdldDogYW55KSA9PiB7XG4gICAgICAgICAgICBjb25zdCBzZXJ2aWNlVG9Nb2NrTmFtZTogc3RyaW5nID0gdGFyZ2V0LmRlcC5uYW1lLnNsaWNlKDAsIC00KTtcbiAgICAgICAgICAgIGNvbnN0IHNlcnZpY2VUb01vY2tUeXBlOiBzdHJpbmcgPSB0aGlzLnNlcnZpY2VUeXBlLmdldChzZXJ2aWNlVG9Nb2NrTmFtZSk7XG5cbiAgICAgICAgICAgIGlmICh0YXJnZXQuZGVwLm5hbWUuc2xpY2UoLTQpICE9PSAnTW9jaycpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBFcnJvcignQ2xhc3MgbmFtZSBtdXN0IGVuZCB3aXRoIFwiTW9ja1wiJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICghdGFyZ2V0Lm92ZXJyaWRlICYmIHNlcnZpY2VUb01vY2tUeXBlID09PSAnZGVmYXVsdCcpIHtcbiAgICAgICAgICAgICAgICBpZiAoISh0YXJnZXQuZGVwLnByb3RvdHlwZSBpbnN0YW5jZW9mIHRoaXMuc2VydmljZS5nZXQoc2VydmljZVRvTW9ja05hbWUpKSkge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBFcnJvcignXCJNb2NrXCIgY2xhc3MgbXVzdCBleHRlbmRzIG1haW4gaW5zdGFuY2UsIG9yIHVzZSBvdmVycmlkZSB0YWcnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuc2VydmljZS5kZWxldGUoc2VydmljZVRvTW9ja05hbWUpO1xuICAgICAgICAgICAgdGhpcy5zZXRNb2Nrcyh0YXJnZXQsIHNlcnZpY2VUb01vY2tUeXBlKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IG1vY2tpbmcgc2VydmljZVxuICAgICAqXG4gICAgICogQHBhcmFtIHRhcmdldCBzZXJ2aWNlIHdoaWNoIHdlIHdhbnQgdG8gbW9ja1xuICAgICAqL1xuICAgIHByaXZhdGUgZ2V0TW9jayh0YXJnZXQ6IGFueSkge1xuICAgICAgICByZXR1cm4gdGhpcy5tb2Nrcy5nZXQoYCR7dGFyZ2V0Lm5hbWV9TW9ja2ApO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENoZWNrIGlmIHRhcmdldCBzZXJ2aWNlLCB0aGUgc2VydmljZSB3ZSB3YW50IHRvIG1vY2tcbiAgICAgKlxuICAgICAqIEBwYXJhbSB0YXJnZXQgc2VydmljZSB3aGljaCB3ZSB3YW50IHRvIG1vY2tcbiAgICAgKi9cbiAgICBwcml2YXRlIGlzTW9ja2VkQ2xhc3ModGFyZ2V0OiBhbnkpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubW9ja3MuaGFzKGAke3RhcmdldC5uYW1lfU1vY2tgKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUaGlzIHdpbGwgcmVzbG92ZSBzZXJ2aWNlLCBpZiBzZXJ2aWNlIGlzIHNpbmxldG9uXG4gICAgICogd2UgbmVlZCBqdXN0IHRvIHJldHVybiBpbnN0YW5jZVxuICAgICAqXG4gICAgICogQHBhcmFtIHRhcmdldCBzZXJ2aWNlXG4gICAgICogQHBhcmFtIGluamVjdGlvbnMgZGVwZW5kZW5jaWVzXG4gICAgICovXG4gICAgcHJpdmF0ZSByZXNvbHZlQnlzZXJ2aWNlVHlwZTxUPih0YXJnZXQ6IElUeXBlPFQ+LCBpbmplY3Rpb25zOiBhbnkpOiBUIHtcbiAgICAgICAgc3dpdGNoICh0aGlzLnNlcnZpY2VUeXBlLmdldCh0YXJnZXQubmFtZSkpIHtcbiAgICAgICAgICAgIGNhc2UgJ3NpbmdsZXRvbic6IHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zZXJ2aWNlLmdldCh0YXJnZXQubmFtZSkgPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gcmVzb2x2ZSBlYWNoIG1vY2tlZCBzZXJ2aWNlIGhlcmVcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coaW5qZWN0aW9ucylcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgaW5qID0gbmV3IHRhcmdldCguLi5pbmplY3Rpb25zKTtcbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VydmljZS5zZXQodGFyZ2V0Lm5hbWUsIGluaik7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBpbmo7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2VydmljZS5nZXQodGFyZ2V0Lm5hbWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2FzZSAnZGVmYXVsdCc6IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IHRhcmdldCguLi5pbmplY3Rpb25zKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGRlZmF1bHQ6IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IHRhcmdldCguLi5pbmplY3Rpb25zKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoaXMgd2lsbCBhZGQgbW9ja2luZyBzZXJ2aWNlcyB0byBzZXJ2aWNlIHByb3BlcnR5XG4gICAgICpcbiAgICAgKiBAcGFyYW0gbW9ja2luZ1NlcnZpY2VcbiAgICAgKiBAcGFyYW0gc2VydmljZVRvTW9ja1R5cGVcbiAgICAgKi9cbiAgICBwcml2YXRlIHNldE1vY2tzKG1vY2tpbmdTZXJ2aWNlOiBhbnksIHNlcnZpY2VUb01vY2tUeXBlOiBzdHJpbmcpIHtcbiAgICAgICAgdGhpcy5zZXJ2aWNlVHlwZS5zZXQobW9ja2luZ1NlcnZpY2UuZGVwLm5hbWUsIHNlcnZpY2VUb01vY2tUeXBlKTtcbiAgICAgICAgdGhpcy5tb2Nrcy5zZXQobW9ja2luZ1NlcnZpY2UuZGVwLm5hbWUsIG1vY2tpbmdTZXJ2aWNlLmRlcCk7XG5cbiAgICAgICAgc3dpdGNoIChzZXJ2aWNlVG9Nb2NrVHlwZSkge1xuICAgICAgICAgICAgY2FzZSAnc2luZ2xldG9uJzoge1xuICAgICAgICAgICAgICAgIHRoaXMuc2VydmljZS5zZXQobW9ja2luZ1NlcnZpY2UuZGVwLm5hbWUsIG51bGwpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2FzZSAnZGVmYXVsdCc6IHtcbiAgICAgICAgICAgICAgICB0aGlzLnNlcnZpY2Uuc2V0KG1vY2tpbmdTZXJ2aWNlLmRlcC5uYW1lLCBtb2NraW5nU2VydmljZS5kZXApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZGVmYXVsdDoge1xuICAgICAgICAgICAgICAgIHRoaXMuc2VydmljZS5zZXQobW9ja2luZ1NlcnZpY2UuZGVwLm5hbWUsIG1vY2tpbmdTZXJ2aWNlLmRlcCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBBZGQgbmV3IHNlcnZpY2VcbiAgICAgKlxuICAgICAqIEBwYXJhbSB0YXJnZXQgbmV3IHNlcnZpY2UgdG8gYWRkXG4gICAgICogQHBhcmFtIHR5cGUgVHlwZSBvZiBzZXJ2aWNlXG4gICAgICovXG4gICAgcHJpdmF0ZSBzZXRzZXJ2aWNlVHlwZSh0YXJnZXQ6IElUeXBlPGFueT4sIHR5cGU/OiBzdHJpbmcpIHtcbiAgICAgICAgdGhpcy5zZXJ2aWNlLnNldCh0YXJnZXQubmFtZSwgdGFyZ2V0KTtcblxuICAgICAgICBzd2l0Y2ggKHR5cGUpIHtcbiAgICAgICAgICAgIGNhc2UgJ3NpbmdsZXRvbic6IHtcbiAgICAgICAgICAgICAgICB0aGlzLnNlcnZpY2VUeXBlLnNldCh0YXJnZXQubmFtZSwgJ3NpbmdsZXRvbicpO1xuICAgICAgICAgICAgICAgIHRoaXMuc2VydmljZS5zZXQodGFyZ2V0Lm5hbWUsIG51bGwpO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRhcmdldDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhc2UgdW5kZWZpbmVkOiB7XG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLnNlcnZpY2VUeXBlLmhhcyh0YXJnZXQubmFtZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXJ2aWNlVHlwZS5zZXQodGFyZ2V0Lm5hbWUsICdkZWZhdWx0Jyk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRhcmdldDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGRlZmF1bHQ6IHtcbiAgICAgICAgICAgICAgICB0aHJvdyBFcnJvcihgUGxlYXNlIGNoZWNrICR7dGFyZ2V0Lm5hbWV9IHNlcnZpY2UuIFNlcnZpY2UgdHlwZSAke3R5cGV9IGRvZXNuJ3QgZXhpc3RzYCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgIH1cbn0oKTtcbiJdfQ==